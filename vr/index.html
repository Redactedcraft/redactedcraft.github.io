<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>RedactedCraft VR | Official Site Replica</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    <script>
      // Component to ensure pixel art stays sharp
      AFRAME.registerComponent('pixelated', {
        init: function () {
          this.el.addEventListener('materialtextureloaded', (e) => {
            const tex = e.detail.texture;
            tex.magFilter = THREE.NearestFilter;
            tex.minFilter = THREE.NearestFilter;
            tex.needsUpdate = true;
          });
        }
      });

      // Custom component for the 3x2 Voxel Texture Atlas (Game Accurate)
      AFRAME.registerComponent('voxel-block', {
        schema: {
          src: {type: 'map'},
          size: {default: 1}
        },
        init: function () {
          this.el.setAttribute('geometry', {
            primitive: 'box',
            width: this.data.size,
            height: this.data.size,
            depth: this.data.size
          });
        },
        update: function () {
          const mesh = this.el.getObject3D('mesh');
          if (!mesh) return;
          const loader = new THREE.TextureLoader();
          loader.load(this.data.src, (texture) => {
            texture.magFilter = THREE.NearestFilter;
            texture.minFilter = THREE.NearestFilter;
            const material = new THREE.MeshBasicMaterial({ map: texture, transparent: true });
            mesh.material = material;
            const geometry = mesh.geometry;
            const uvAttr = geometry.attributes.uv;
            const tiles = [
                {x: 1, y: 0}, // PosX (+x)
                {x: 1, y: 1}, // NegX (-x)
                {x: 0, y: 0}, // PosY (+y)
                {x: 2, y: 0}, // NegY (-y)
                {x: 0, y: 1}, // PosZ (+z)
                {x: 2, y: 1}  // NegZ (-z)
            ];
            for (let i = 0; i < 6; i++) {
                const u0 = tiles[i].x / 3;
                const v0 = 1 - (tiles[i].y + 1) / 2;
                const u1 = (tiles[i].x + 1) / 3;
                const v1 = 1 - tiles[i].y / 2;
                const eps = 0.002; // Bleed protection
                const su0 = u0 + eps, sv0 = v0 + eps, su1 = u1 - eps, sv1 = v1 - eps;
                const base = i * 4;
                uvAttr.setXY(base,     su0, sv1);
                uvAttr.setXY(base + 1, su1, sv1);
                uvAttr.setXY(base + 2, su0, sv0);
                uvAttr.setXY(base + 3, su1, sv0);
            }
            uvAttr.needsUpdate = true;
          });
        }
      });
    </script>
    <style>
      .a-enter-vr-button { background-color: #4e9a06 !important; }
    </style>
  </head>
  <body>
    <a-scene renderer="antialias: false; colorManagement: true;">
      
      <a-assets>
        <img id="logo-img" src="../assets/img/logo.png" crossorigin="anonymous">
        <img id="hero-img" src="../assets/img/hero_bg.png" crossorigin="anonymous">
        <img id="grass-atlas" src="../assets/img/grass.png" crossorigin="anonymous">
      </a-assets>

      <a-entity environment="preset: pixel; seed: 42; dressingAmount: 50; grid: dots; groundColor: #1a1a1a; skyColor: #111; horizonColor: #333;"></a-entity>

      <!-- Rig with Movement -->
      <a-entity id="rig" position="0 0 6">
        <a-camera look-controls wasd-controls>
          <a-cursor color="#4e9a06" fuse="false" raycaster="objects: .clickable"></a-cursor>
          <a-entity class="clickable" id="exit-btn-hud" position="1.5 -0.8 -2" geometry="primitive: plane; width: 0.4; height: 0.15" material="color: #1a1a1a; opacity: 0.9" onclick="window.location.href='../'">
            <a-text value="EXIT VR" align="center" color="#4e9a06" width="1.2"></a-text>
          </a-entity>
        </a-camera>
        <a-entity laser-controls="hand: left" raycaster="objects: .clickable; far: 10; showLine: true;"></a-entity>
        <a-entity laser-controls="hand: right" raycaster="objects: .clickable; far: 10; showLine: true;"></a-entity>
      </a-entity>

      <!-- GIANT VIRTUAL KIOSK (Site Replica) -->
      <a-entity id="kiosk" position="0 2.5 -5" scale="2 2 2">
        
        <!-- Background Wrapper -->
        <a-image src="#hero-img" width="6" height="4.5" position="0 0 -0.2" pixelated opacity="0.5"></a-image>
        <a-plane color="#1a1a1a" width="6.1" height="4.6" position="0 0 -0.25"></a-plane>

        <!-- Header -->
        <a-entity id="header" position="0 1.8 0">
          <a-plane color="#111" width="6" height="1" position="0 0 -0.1" material="shader: flat"></a-plane>
          <a-image src="#logo-img" width="1.8" height="0.45" position="0 0.15 0" pixelated transparent="true"></a-image>
          <a-text value="OFFICIAL DEVELOPER PORTAL" align="center" position="0 -0.2 0" color="#4e9a06" width="3"></a-text>
        </a-entity>

        <!-- Navbar (Tabs) -->
        <a-entity id="navbar" position="0 1.2 0">
          <a-plane color="#222" width="6" height="0.3" position="0 0 -0.05"></a-plane>
          <a-entity class="clickable nav-btn" data-target="home" position="-2 0 0" geometry="primitive: plane; width: 0.8; height: 0.25" material="color: #4e9a06">
            <a-text value="HOME" align="center" color="#fff" width="2.5"></a-text>
          </a-entity>
          <a-entity class="clickable nav-btn" data-target="assets" position="-0.7 0 0" geometry="primitive: plane; width: 0.9; height: 0.25" material="color: #333">
            <a-text value="TEXTURES" align="center" color="#fff" width="2.5"></a-text>
          </a-entity>
          <a-entity class="clickable nav-btn" data-target="coding" position="0.7 0 0" geometry="primitive: plane; width: 0.9; height: 0.25" material="color: #333">
            <a-text value="DEV LOG" align="center" color="#fff" width="2.5"></a-text>
          </a-entity>
          <a-entity class="clickable nav-btn" data-target="about" position="2 0 0" geometry="primitive: plane; width: 0.8; height: 0.25" material="color: #333">
            <a-text value="ABOUT" align="center" color="#fff" width="2.5"></a-text>
          </a-entity>
        </a-entity>

        <!-- Content Area -->
        <a-entity id="panels" position="0 -0.6 0">
          
          <!-- HOME -->
          <a-entity id="panel-home" class="panel" visible="true">
            <a-plane color="#2d2d2d" width="5.8" height="3" position="0 0 -0.1"></a-plane>
            <a-text value="THE ART OF THE PIXEL" align="center" position="0 1.2 0" color="#e9b96e" width="6"></a-text>
            <a-text value="Redactedcraft is an experimental voxel project focused on performance and aesthetic clarity. Built from scratch in C# using MonoGame, it pushes the boundaries of what a solo dev engine can do." 
                    align="center" position="0 0.7 0" color="#f0f0f0" width="5" wrap-count="60"></a-text>
            
            <a-entity position="-1.8 -0.2 0">
               <a-plane color="#111" width="1.6" height="1.2" material="shader: flat"></a-plane>
               <a-text value="INFINITE TERRAIN" align="center" position="0 0.4 0.01" color="#e9b96e" width="3"></a-text>
               <a-text value="Procedural generation\nusing multi-layered\nSimplex noise." align="center" position="0 -0.1 0.01" color="#ccc" width="2.5"></a-text>
            </a-entity>
            <a-entity position="0 -0.2 0">
               <a-plane color="#111" width="1.6" height="1.2" material="shader: flat"></a-plane>
               <a-text value="GREEDY MESHING" align="center" position="0 0.4 0.01" color="#e9b96e" width="3"></a-text>
               <a-text value="Optimized rendering\nthat merges adjacent\nfaces into single quads." align="center" position="0 -0.1 0.01" color="#ccc" width="2.5"></a-text>
            </a-entity>
            <a-entity position="1.8 -0.2 0">
               <a-plane color="#111" width="1.6" height="1.2" material="shader: flat"></a-plane>
               <a-text value="EOS MULTIPLAYER" align="center" position="0 0.4 0.01" color="#e9b96e" width="3"></a-text>
               <a-text value="Built on Epic Online\nServices for robust\nP2P networking." align="center" position="0 -0.1 0.01" color="#ccc" width="2.5"></a-text>
            </a-entity>
            
            <a-entity class="clickable" position="0 -1.1 0" geometry="primitive: plane; width: 3; height: 0.3" material="color: #4e9a06" onclick="window.open('https://github.com/Redactedcraft/Redactedcraft/releases/latest', '_blank')">
              <a-text value="DOWNLOAD GAME (LATEST)" align="center" color="#fff" width="4"></a-text>
            </a-entity>
          </a-entity>

          <!-- TEXTURES -->
          <a-entity id="panel-assets" class="panel" visible="false">
            <a-plane color="#2d2d2d" width="5.8" height="3" position="0 0 -0.1"></a-plane>
            <a-text value="STANDARD BLOCK LIBRARY" align="center" position="0 1.3 0" color="#e9b96e" width="5"></a-text>
            
            <!-- 2D Grid -->
            <a-entity id="block-grid" position="-1.4 0 0"></a-entity>

            <!-- 3D Inspector Replica -->
            <a-entity id="inspector" position="1.6 0 0">
              <a-plane color="#111" width="2.2" height="2.4" position="0 0 -0.05"></a-plane>
              <a-text id="ins-name" value="GRASS" align="center" position="0 1 0.01" color="#e9b96e" width="4"></a-text>
              <a-entity id="ins-block-parent" position="0 0 0.5" animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear">
                <a-entity id="ins-block" voxel-block="src: ../assets/img/grass.png; size: 1"></a-entity>
              </a-entity>
              <a-text id="ins-desc" value="Lush greenery for the surface layer." align="center" position="0 -0.8 0.01" color="#ccc" width="2.5" wrap-count="30"></a-text>
            </a-entity>
          </a-entity>

          <!-- DEV LOG (Scrollable via Buttons) -->
          <a-entity id="panel-coding" class="panel" visible="false">
            <a-plane color="#2d2d2d" width="5.8" height="3" position="0 0 -0.1"></a-plane>
            <a-text value="DEVELOPER LOGS" align="center" position="0 1.3 0" color="#e9b96e" width="5"></a-text>
            
            <a-entity id="log-container" position="0 0.8 0">
               <a-entity id="log-scroller" position="0 0 0">
                 <a-text id="log-text" value="" align="left" position="-2.5 -0.2 0.01" color="#f0f0f0" width="5" wrap-count="60"></a-text>
               </a-entity>
            </a-entity>

            <!-- Scroll Buttons -->
            <a-entity class="clickable scroll-btn" data-dir="1" position="2.6 0.3 0" geometry="primitive: triangle; vertexA: 0 0.1 0; vertexB: -0.1 -0.1 0; vertexC: 0.1 -0.1 0" material="color: #4e9a06"></a-entity>
            <a-entity class="clickable scroll-btn" data-dir="-1" position="2.6 -0.3 0" geometry="primitive: triangle; vertexA: 0 -0.1 0; vertexB: 0.1 0.1 0; vertexC: -0.1 0.1 0" material="color: #4e9a06"></a-entity>
          </a-entity>

          <!-- ABOUT -->
          <a-entity id="panel-about" class="panel" visible="false">
            <a-plane color="#2d2d2d" width="5.8" height="3" position="0 0 -0.1"></a-plane>
            <a-text value="SOLO DEVELOPMENT" align="center" position="0 1.2 0" color="#e9b96e" width="6"></a-text>
            <a-text value="Redactedcraft is a passion project developed entirely solo. The goal is to build a modern, high-performance foundation for voxel games that respects the retro aesthetic of the past.\n\nVisit redactedcraft.github.io on desktop for full social links and asset downloads." 
                    align="center" position="0 0.2 0" color="#f0f0f0" width="5" wrap-count="50"></a-text>
          </a-entity>

        </a-entity>
      </a-entity>

    </a-scene>

    <script>
      const textureData = [
          { id: 'grass', name: 'GRASS', desc: 'Lush greenery for the surface layer.' },
          { id: 'dirt', name: 'DIRT', desc: 'Standard soil found beneath the grass.' },
          { id: 'stone', name: 'STONE', desc: 'Dense rock forming the world\'s crust.' },
          { id: 'sand', name: 'SAND', desc: 'Fine grains found in deserts and beaches.' },
          { id: 'wood', name: 'WOOD', desc: 'Raw timber harvested from trees.' },
          { id: 'leaves', name: 'LEAVES', desc: 'Translucent foliage from the canopy.' },
          { id: 'water', name: 'WATER', desc: 'Fluid life-giving substance of the oceans.' },
          { id: 'diamond', name: 'DIAMOND', desc: 'The hardest and most precious material.' },
          { id: 'iron', name: 'IRON', desc: 'Essential metal for durable equipment.' },
          { id: 'gold', name: 'GOLD', desc: 'Rare, heavy metal for the elite.' },
          { id: 'plank', name: 'PLANK', desc: 'Refined wood for building structures.' },
          { id: 'glass', name: 'GLASS', desc: 'Smelted sand, perfect for windows.' }
      ];

      const logLines = [
        "JAN 12: Restoring Order: EOS Fixes & Repo Cleanup\n- Strictly using eos-service.onrender.com\n- Added automatic credential fallback\n- Removed sensitive SDK tools",
        "JAN 11: Developer Update: Pro Build Tools\n- Unified Build GUI implemented\n- Automated single-file publishing\n- Simplified source distribution",
        "JAN 10: Launcher: Legacy Cleanup & Skipping\n- Removed deprecated atlas requirement\n- Fixed legacy URL issues\n- Improved sync logic",
        "JAN 10: Asset Restoration: Screenshots BG\n- Synchronized Screenshots_bg.png across channels",
        "DEC 20: World: Greedy Meshing Optimization\n- 400% performance increase in complex terrain"
      ];

      // Populate Block Grid
      const grid = document.getElementById('block-grid');
      textureData.forEach((b, i) => {
        const x = (i % 4) * 0.7 - 1.05;
        const y = Math.floor(i / 4) * -0.7 + 0.7;
        
        const btn = document.createElement('a-entity');
        btn.setAttribute('position', `${x} ${y} 0`);
        btn.setAttribute('class', 'clickable block-btn');
        
        const p = document.createElement('a-plane');
        p.setAttribute('width', '0.6');
        p.setAttribute('height', '0.6');
        p.setAttribute('material', 'color: #333; shader: flat');
        
        const img = document.createElement('a-image');
        img.setAttribute('src', `../assets/img/${b.id}.png`);
        img.setAttribute('width', '0.5');
        img.setAttribute('height', '0.5');
        img.setAttribute('position', '0 0 0.01');
        img.setAttribute('pixelated', '');

        btn.appendChild(p);
        btn.appendChild(img);
        grid.appendChild(btn);

        btn.addEventListener('click', () => {
          document.getElementById('ins-name').setAttribute('value', b.name);
          document.getElementById('ins-desc').setAttribute('value', b.desc);
          document.getElementById('ins-block').setAttribute('voxel-block', 'src', `../assets/img/${b.id}.png`);
        });
      });

      // Populate Logs
      document.getElementById('log-text').setAttribute('value', logLines.join('\n\n'));

      // Navigation Logic
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const target = btn.getAttribute('data-target');
          document.querySelectorAll('.nav-btn').forEach(b => b.setAttribute('material', 'color', '#333'));
          btn.setAttribute('material', 'color', '#4e9a06');
          document.querySelectorAll('.panel').forEach(p => p.setAttribute('visible', 'false'));
          document.getElementById('panel-' + target).setAttribute('visible', 'true');
        });
      });

      // Scrolling Logic
      let scrollY = 0;
      document.querySelectorAll('.scroll-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const dir = parseInt(btn.getAttribute('data-dir'));
          scrollY += dir * 0.2;
          scrollY = Math.max(0, Math.min(scrollY, 2)); // Clamp
          document.getElementById('log-scroller').setAttribute('position', `0 ${scrollY} 0`);
        });
      });

      // Global Link Handler
      document.querySelectorAll('.clickable').forEach(el => {
        el.addEventListener('click', () => {
          const clickAttr = el.getAttribute('onclick');
          if (clickAttr && clickAttr.includes('window')) {
             const url = clickAttr.match(/'([^']+)'/)[1];
             if (clickAttr.includes('open')) window.open(url, '_blank');
             else window.location.href = url;
          }
        });
      });
    </script>
  </body>
</html>